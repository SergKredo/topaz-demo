<div class="page">
	<div class="page-header">
		<h1 class="title">Topaz Signature Demo</h1>
	</div>

	<div class="grid">
		<section class="card">
			<h2 class="card-title">Status</h2>
			<div class="kv">SigWeb version: <span class="mono">{{ topaz.version() ?? '—' }}</span></div>
			<div class="kv" *ngIf="topaz.isHttpsPage">
				Local HTTPS bridge ({{ topaz.bridgeOriginForDisplay }}):
				<span class="mono">{{ topaz.bridgeDetected() === null ? '—' : (topaz.bridgeDetected() ? 'Detected' : 'Not detected') }}</span>
			</div>
			<div class="kv prewrap" *ngIf="topaz.isHttpsPage && topaz.bridgeDetected() === false">
				Hint: start it with <span class="mono">npm run demo:https</span> and open
				<span class="mono">{{ topaz.bridgeOriginForDisplay }}/</span> once to approve the certificate.
			</div>
			<div class="kv">
				Tablet connected:
				<span class="mono">{{ topaz.tabletConnected() === null ? '—' : (topaz.tabletConnected() ? 'Yes' : 'No') }}</span>
			</div>
			<div class="kv" *ngIf="topaz.lastAction()">Last action: <span class="mono">{{ topaz.lastAction() }}</span></div>
			<div class="kv prewrap" *ngIf="topaz.lastError()">Error: <span class="mono">{{ topaz.lastError() }}</span></div>
			<div class="hint">
				Steps: 1) Click Start 2) Sign on the tablet 3) Click Save to show image.
			</div>
		</section>

		<section class="card">
			<h2 class="card-title">Capture</h2>
			<div class="actions">
				<button class="btn btn-primary" type="button" (click)="start()">Start</button>
				<button class="btn" type="button" (click)="clear()">Clear</button>
				<button class="btn" type="button" (click)="save()">Save</button>
			</div>
			<div class="signature-preview">
				<img *ngIf="signatureImage" [src]="signatureImage" />
			</div>
		</section>
	</div>

	<section class="card">
		<h2 class="card-title">SigWeb REST API (reference)</h2>

		<h3 class="section-title">Prerequisites (Topaz setup for this demo)</h3>
		<div class="stack">
			<div>
				This demo talks to the local SigWeb REST host on <code>http://localhost:47289/sigweb</code>.
				To make it work, install and start SigWeb on the same Windows PC where you open this site.
			</div>

			<div>
				<b>Official downloads (Topaz Systems)</b>
				<ul>
					<li><a href="https://topazsystems.com/sdks/sigweb.html" target="_blank" rel="noopener noreferrer">SigWeb SDK page (overview + links)</a></li>
					<li><a href="https://www.topazsystems.com/software/sigweb.exe" target="_blank" rel="noopener noreferrer">SigWeb installer (sigweb.exe)</a></li>
					<li>
						SigWeb certificate installer:
						<a href="https://topazsystems.com/software/sigwebcertinstaller.exe" target="_blank" rel="noopener noreferrer">EXE</a>
						/
						<a href="https://topazsystems.com/software/sigwebcertinstaller.zip" target="_blank" rel="noopener noreferrer">ZIP</a>
					</li>
					<li><a href="https://www.topazsystems.com/Software/sigweb_install.pdf" target="_blank" rel="noopener noreferrer">SigWeb Installation Help Guide (PDF)</a></li>
					<li><a href="https://www.topazsystems.com/Software/download/sigweb.pdf" target="_blank" rel="noopener noreferrer">SigWeb Developer Guide (PDF)</a></li>
					<li><a href="https://www.topazsystems.com/software/SigWeb_Test_Utility.exe" target="_blank" rel="noopener noreferrer">SigWeb Test Utility</a></li>
					<li><a href="https://www.sigplusweb.com/SigWebTablet.js" target="_blank" rel="noopener noreferrer">SigWebTablet.js (sigplusweb.com)</a></li>
					<li><a href="https://topazsystems.com/software/" target="_blank" rel="noopener noreferrer">Topaz software downloads hub</a></li>
				</ul>
			</div>

			<div>
				<b>1) Install SigWeb</b>
				<ul>
					<li>Install <b>Topaz SigWeb</b> (from the official Topaz Systems installer).</li>
					<li>Make sure the REST host component is installed (SigWeb REST host / SigRESTHost).</li>
					<li>After install, confirm the SigWeb host is running and listening on port <code>47289</code> (HTTP).</li>
				</ul>
			</div>

			<div>
				<b>2) Connect the tablet + drivers</b>
				<ul>
					<li>Connect the Topaz tablet via USB (or serial, depending on your model).</li>
					<li>If Windows does not recognize the device, install the official Topaz drivers for your model.</li>
					<li>
						<a href="https://www.sigpluspro.com/" target="_blank" rel="noopener noreferrer">SigPlus drivers & installers (official)</a>
						— select your specific tablet model/device to download the correct driver.
					</li>
					<li>Unplug/replug the tablet after driver installation.</li>
				</ul>
			</div>

			<div>
				<b>3) Verify SigWeb is reachable (quick checks)</b>
				<ul>
					<li>Open: <code>http://localhost:47289/sigweb/version</code> (should return a version string).</li>
					<li>Open: <code>http://localhost:47289/sigweb/TabletConnectQuery</code> (should return <code>1</code> when a tablet is detected).</li>
					<li>If it returns <code>0</code>, SigWeb does not see the tablet yet (check cable/driver/device settings).</li>
				</ul>
			</div>

			<div>
				<b>4) Firewall / permissions</b>
				<ul>
					<li>Allow local HTTP access to port <code>47289</code> for the SigWeb host in Windows Firewall (if blocked).</li>
					<li>Run the installer as Administrator if the service fails to register/start.</li>
				</ul>
			</div>

			<div>
				<b>5) Notes</b>
				<ul>
					<li>This demo uses <code>localhost</code>, so SigWeb must run on the same machine as your browser.</li>
					<li>
						If you open this demo from GitHub Pages (HTTPS), the browser blocks calls to <code>http://localhost</code>
						(mixed content). SigWeb is also typically HTTP-only on port <code>47289</code>, so <code>https://localhost:47289</code>
						may fail with <code>ERR_SSL_PROTOCOL_ERROR</code>.
					</li>
					<li>
						To use the deployed demo (<code>https://sergkredo.github.io/topaz-demo/</code>) with a local SigWeb, you must run a local
						HTTPS host on <code>https://localhost:9443</code> (the bridge). It serves the demo over HTTPS and proxies SigWeb.
						<ul>
							<li>Install Node.js (so <code>npm</code> works).</li>
							<li><code>npm install</code> (repo root)</li>
							<li><code>npm run demo:https</code> (build + start <code>https://localhost:9443</code>)</li>
							<li>Open <code>https://localhost:9443/</code> once and approve the certificate warning.</li>
						</ul>
						If the user does not have this project folder, they must download and run the bridge executable instead:
						<ul>
							<li><a href="https://github.com/SergKredo/topaz-demo/releases" target="_blank" rel="noopener noreferrer">Download Topaz Demo Bridge (EXE) from GitHub Releases</a></li>
							<li>Run the EXE (starts <code>https://localhost:9443</code>), then open <code>https://localhost:9443/</code> once to approve the certificate.</li>
						</ul>
						If Chrome shows <code>ERR_CERT_AUTHORITY_INVALID</code>, this is expected with a self-signed cert. To remove the warning, create a locally trusted cert
						(e.g. via <a href="https://github.com/FiloSottile/mkcert" target="_blank" rel="noopener noreferrer">mkcert</a>) and place it in <code>bridge/certs</code>
						(see <a href="https://github.com/SergKredo/topaz-demo/tree/main/bridge" target="_blank" rel="noopener noreferrer">bridge/README.md</a>).
						Bridge details (source + troubleshooting):
						<a href="https://github.com/SergKredo/topaz-demo/tree/main/bridge" target="_blank" rel="noopener noreferrer">bridge/README.md</a>
						Then the deployed site will call <code>https://localhost:9443/sigweb</code> (bridge) → <code>http://localhost:47289/sigweb</code> (SigWeb).
					</li>
					<li>
						If you run the demo locally over HTTP (<code>http://localhost:4200</code>), you do not need the bridge.
						Start it with: <code>npm start</code>.
					</li>
					<li>WebSocket is not used here: the SigWeb host exposes HTTP/WCF REST endpoints, not WebSocket upgrade.</li>
				</ul>
			</div>
		</div>

		<div class="divider"></div>

		<div class="stack">
			<div class="kv"><b>Base URL:</b> <code>{{ topaz.baseUrl }}</code></div>
			<div>
				<b>Typical flow:</b>
				<code>Start</code> → sign on the tablet → <code>Save</code> (fetch image) → <code>Clear</code>.
			</div>
			<div>
				<b>HTTP rules:</b>
				most “read” endpoints are <code>GET</code>; many “command” endpoints require <code>POST</code> and a non-empty
				body (so the request has <code>Content-Length</code>, e.g. <code>x=</code>).
			</div>
			<div>
				<b>Important:</b>
				SigWeb must detect the device (see <code>/TabletConnectQuery</code>). If it returns <code>0</code>, capture/image
				endpoints may return empty results.
			</div>
		</div>

		<div class="divider"></div>

		<h3 class="section-title">Verified endpoints (this demo uses)</h3>
<div *ngFor="let item of apiDocs">
	<div *ngIf="item.group === 'Verified endpoints (this demo uses)'"><button type="button" class="api-link" (click)="toggleApiDetails(item.id)"><code>{{ item.method }} {{ item.path }}</code> — {{ item.short }}</button></div>
	<div *ngIf="expandedApiId === item.id" class="api-details">
		<div *ngIf="item.purpose.length">
			<b>What it does:</b>
			<ul>
				<li *ngFor="let line of item.purpose">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.params?.length">
			<b>Parameters:</b>
			<ul>
				<li *ngFor="let p of item.params"><code>{{ p.location }}</code> <code>{{ p.name }}</code> — {{ p.meaning }}<span *ngIf="p.example"> (e.g. <code>{{ p.example }}</code>)</span></li>
			</ul>
		</div>
		<div *ngIf="item.requestBody?.length">
			<b>Request body:</b>
			<ul>
				<li *ngFor="let line of item.requestBody">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.response?.length">
			<b>Response:</b>
			<ul>
				<li *ngFor="let line of item.response">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.notes?.length">
			<b>Notes:</b>
			<ul>
				<li *ngFor="let line of item.notes">{{ line }}</li>
			</ul>
		</div>
	</div>
</div>

<div class="divider"></div>

		<h3 class="section-title">More available endpoints (from installed SigWeb REST host)</h3>
<div>
	The list below is extracted from the local SigWeb installation. Availability and exact URL shape can vary by
	version/device/configuration.
</div>

		<h4 class="section-subtitle">Tablet / capture</h4>
<div *ngFor="let item of apiDocs">
	<div *ngIf="item.group === 'Tablet / capture'"><button type="button" class="api-link" (click)="toggleApiDetails(item.id)"><code>{{ item.method }} {{ item.path }}</code> — {{ item.short }}</button></div>
	<div *ngIf="expandedApiId === item.id" class="api-details">
		<div *ngIf="item.purpose.length">
			<b>What it does:</b>
			<ul>
				<li *ngFor="let line of item.purpose">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.params?.length">
			<b>Parameters:</b>
			<ul>
				<li *ngFor="let p of item.params"><code>{{ p.location }}</code> <code>{{ p.name }}</code> — {{ p.meaning }}<span *ngIf="p.example"> (e.g. <code>{{ p.example }}</code>)</span></li>
			</ul>
		</div>
		<div *ngIf="item.requestBody?.length">
			<b>Request body:</b>
			<ul>
				<li *ngFor="let line of item.requestBody">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.response?.length">
			<b>Response:</b>
			<ul>
				<li *ngFor="let line of item.response">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.notes?.length">
			<b>Notes:</b>
			<ul>
				<li *ngFor="let line of item.notes">{{ line }}</li>
			</ul>
		</div>
	</div>
</div>

		<h4 class="section-subtitle">Signature data</h4>
<div *ngFor="let item of apiDocs">
	<div *ngIf="item.group === 'Signature data'"><button type="button" class="api-link" (click)="toggleApiDetails(item.id)"><code>{{ item.method }} {{ item.path }}</code> — {{ item.short }}</button></div>
	<div *ngIf="expandedApiId === item.id" class="api-details">
		<div *ngIf="item.purpose.length">
			<b>What it does:</b>
			<ul>
				<li *ngFor="let line of item.purpose">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.params?.length">
			<b>Parameters:</b>
			<ul>
				<li *ngFor="let p of item.params"><code>{{ p.location }}</code> <code>{{ p.name }}</code> — {{ p.meaning }}<span *ngIf="p.example"> (e.g. <code>{{ p.example }}</code>)</span></li>
			</ul>
		</div>
		<div *ngIf="item.requestBody?.length">
			<b>Request body:</b>
			<ul>
				<li *ngFor="let line of item.requestBody">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.response?.length">
			<b>Response:</b>
			<ul>
				<li *ngFor="let line of item.response">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.notes?.length">
			<b>Notes:</b>
			<ul>
				<li *ngFor="let line of item.notes">{{ line }}</li>
			</ul>
		</div>
	</div>
</div>

		<h4 class="section-subtitle">LCD (for LCD-capable tablets)</h4>
<div *ngFor="let item of apiDocs">
	<div *ngIf="item.group === 'LCD (for LCD-capable tablets)'"><button type="button" class="api-link" (click)="toggleApiDetails(item.id)"><code>{{ item.method }} {{ item.path }}</code> — {{ item.short }}</button></div>
	<div *ngIf="expandedApiId === item.id" class="api-details">
		<div *ngIf="item.purpose.length">
			<b>What it does:</b>
			<ul>
				<li *ngFor="let line of item.purpose">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.params?.length">
			<b>Parameters:</b>
			<ul>
				<li *ngFor="let p of item.params"><code>{{ p.location }}</code> <code>{{ p.name }}</code> — {{ p.meaning }}<span *ngIf="p.example"> (e.g. <code>{{ p.example }}</code>)</span></li>
			</ul>
		</div>
		<div *ngIf="item.requestBody?.length">
			<b>Request body:</b>
			<ul>
				<li *ngFor="let line of item.requestBody">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.response?.length">
			<b>Response:</b>
			<ul>
				<li *ngFor="let line of item.response">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.notes?.length">
			<b>Notes:</b>
			<ul>
				<li *ngFor="let line of item.notes">{{ line }}</li>
			</ul>
		</div>
	</div>
</div>

		<h4 class="section-subtitle">Device configuration</h4>
<div *ngFor="let item of apiDocs">
	<div *ngIf="item.group === 'Device configuration'"><button type="button" class="api-link" (click)="toggleApiDetails(item.id)"><code>{{ item.method }} {{ item.path }}</code> — {{ item.short }}</button></div>
	<div *ngIf="expandedApiId === item.id" class="api-details">
		<div *ngIf="item.purpose.length">
			<b>What it does:</b>
			<ul>
				<li *ngFor="let line of item.purpose">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.params?.length">
			<b>Parameters:</b>
			<ul>
				<li *ngFor="let p of item.params"><code>{{ p.location }}</code> <code>{{ p.name }}</code> — {{ p.meaning }}<span *ngIf="p.example"> (e.g. <code>{{ p.example }}</code>)</span></li>
			</ul>
		</div>
		<div *ngIf="item.requestBody?.length">
			<b>Request body:</b>
			<ul>
				<li *ngFor="let line of item.requestBody">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.response?.length">
			<b>Response:</b>
			<ul>
				<li *ngFor="let line of item.response">{{ line }}</li>
			</ul>
		</div>
		<div *ngIf="item.notes?.length">
			<b>Notes:</b>
			<ul>
				<li *ngFor="let line of item.notes">{{ line }}</li>
			</ul>
		</div>
	</div>
</div>

		<h4 class="section-subtitle">Full extracted path list (raw)</h4>
<div>
	<div *ngFor="let group of rawApiGroups">
		<h5 class="group-title">{{ group.name }}</h5>
		<div *ngFor="let item of group.items">
			<div>
				<button type="button" class="api-link" (click)="toggleRawApiDetails(item.key)">
					<code>{{ item.methodGuess }} {{ item.path }}</code>
					<span *ngIf="item.suffix"> (flag <code>{{ item.suffix }}</code>)</span>
					— {{ item.short }}
				</button>
			</div>
			<div *ngIf="expandedRawApiKey === item.key" class="api-details">
				<div><b>Raw token:</b> <code>{{ item.raw }}</code></div>
				<div><b>Call URL:</b> <code>{{ topaz.baseUrl }}{{ item.path }}</code></div>
				<div *ngIf="item.params.length">
					<b>Path parameters:</b>
					<ul>
						<li *ngFor="let p of item.params"><code>{{ p }}</code> — replace in the URL path (example: <code>/.../{{ p }}/...</code>).</li>
					</ul>
				</div>
				<div *ngIf="item.notes.length">
					<b>Notes:</b>
					<ul>
						<li *ngFor="let n of item.notes">{{ n }}</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
	</section>
</div>
